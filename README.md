[![DOI](https://zenodo.org/badge/612281563.svg)](https://zenodo.org/badge/latestdoi/612281563)

# Variation in body size drives spatial and temporal variation in lobster-urchin interaction strength

**Bartholomew P. DiFiore and Adrian C. Stier**

This repository holds all code to reproduce the analysis and figures related to DiFiore and Stier (2023) published in the Journal of Animal Ecology. Please note we did some post-processing of figures (color changes, labels, paneling, etc.) in the open source software [Inkscape](https://inkscape.org/), so the generated figures will not match the published figures exactly. To run all code directly, you will need to have [Stan](https://mc-stan.org/) already downloaded. Some code files have long run times (\> 1 hour).

![The size frequency distributions of predators, such as lobster, and their prey, such as urchins, can vary across space or through time even. Such variation can lead to considerable differences in how strongly predators interact with their prey.](DiFiore_graphicalabstract.png)

## Manuscript abstract

1.  How strongly predators and prey interact is both notoriously context dependent and difficult to measure. Yet across taxa, interaction strength is strongly related to predator size, prey size, and prey density, suggesting that general cross-taxonomic relationships could be used to predict how strongly individual species interact.
2.  Here, we ask how accurately do general size-scaling relationships predict variation in interaction strength between specific species that vary in size and density across space and time?
3.  To address this question, we quantified the size and density-dependence of the functional response of the California spiny lobster (*Panulirus interruptus*), foraging on a key ecosystem engineer, the purple sea urchin (*Strongylocentrotus purpuratus*), in experimental mesocosms. Based on these results, we then estimated variation in lobster-urchin interaction strength across five sites and nine years of observational data. Finally, we compared our experimental estimates to predictions based on general size-scaling relationships from the literature.
4.  Our results reveal that predator and prey body size has the greatest effect on interaction strength when prey abundance is high. Due to consistently high urchin densities in the field, our simulations suggest that body size---relative to density---accounted for up to 87% of the spatio-temporal variation in interaction strength. However, general size-scaling relationships failed to predict the magnitude of interactions between lobster and urchin; even the best prediction from the literature was, on average, an order of magnitude (+18.7x) different than our experimental predictions.
5.  Harvest and climate change are driving reductions in the average body size of many marine species. Anticipating how reductions in body size will alter species interactions is critical to managing marine systems in an ecosystem context. Our results highlight the extent to which differences in size-frequency distributions can drive dramatic variation in the strength of interactions across narrow spatial and temporal scales. Furthermore, our work suggests that species-specific estimates for the scaling of interaction strength with body size, rather than general size-scaling relationships, are necessary to quantitatively predict how reductions in body size will alter interaction strengths.

This repo is maintained by Bart DiFiore (GitHub: [\@bartdifiore](https://github.com/bartdifiore)) at the University of California, Santa Barbara in the Department of Ecology, Evolution, & Marine Biology. For questions or inquires please contact [bdifiore\@ucsb.edu](mailto:bdifiore@ucsb.edu){.email}.

## Code

| File                                 | Description                                                                                                                                                                                                                                |
|--------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1_setup.R                            | Load libraries and download all data from the environmental data initiative (EDI) public data repositories.                                                                                                                                |
| 2_Figure1.R                          | Script to reconstruct the histograms in the first conceptual figure. Post-processing conducted in Inkscape.                                                                                                                                |
| 3_STAN_poissonNONcentered.R          | Construct and run the STAN model to fit the size-dependent functional response to the foraging data.                                                                                                                                       |
| 4_STAN_modelplots.R                  | Generate figures from the posterior distributions of the STAN model.                                                                                                                                                                       |
| 5_clean-obsdata.R                    | Bring in and clean up observational data.                                                                                                                                                                                                  |
| 6_scenarios.R                        | Run scenario analysis to estimate predicted interactions strengths using the observational data and either the experimentally derived functional response, or functional responses parameterized from different sources in the literature. |
| 6b_scenarios_wparameteruncertainty.R | Similar to analysis in 6_scenarios.R except now including parameter uncertainly along with variation due to differences in body size and density across space and time.                                                                    |
| 7_varPart.R                          | Partition variation in interaction strength between body size and density using a simulation procedure.                                                                                                                                    |
| 8_simulation.R                       | Simulate a community of lobster and urchins. Examine changes in interaction strength after a 10x increase in body size vs. a 10x increase in urchin density.                                                                               |
| 9_mapping.R                          | Construct map and inset panels for figure 3 of the manuscript.                                                                                                                                                                             |
| STAN_models                          | folder to house STAN model produced in 3_STAN_poissonNONcentered.R                                                                                                                                                                         |
| theme.R                              | Theme function used to generate ggplot figures.                                                                                                                                                                                            |

## Data

All data can be read directly into the local work space by running the script "1_setup.R". Data are archived at the Environmental Data Initiative (EDI) through the Santa Barbara Coastal Long Term Ecological Research ([SBC LTER](https://sbclter.msi.ucsb.edu/data/)) data management program. Spatial data used to produce the map (Figure 4 in manuscript) are stored in this repository. To generate the map you must have Git LFS (large file storage) configured locally, and initialized on the clone of the repository.

## Accessibility and usage

We believe in the open data practices in science (see [Openscapes](https://www.openscapes.org/) for more information on open data science), and welcome others to utilize the data or code used to produce this manuscript. We ask that if you utilize the data you cite the data package(s) listed below and if you utilize the code you cite the manuscript and/or this github repo. Please note that the observational data collected through the LTER are ongoing. Our scripts will directly download the specific time series used in producing the manuscript. However, here we provide links to the most up to date data package.

| Data/Code Source                                    | Citation                                                                                                                                                                                                                                                       |
|-----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Time series of lobster abundance and size structure | Reed, D, R. Miller. 2022. SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012 ver 8. Environmental Data Initiative. <https://doi.org/10.6073/pasta/25aa371650a671bafad64dd25a39ee18>.  |
| Time series of urchin size structure                | Reed, D, R. Miller. 2022. SBC LTER: Reef: Long-term experiment: Kelp removal: Urchin size frequency distribution ver 22. Environmental Data Initiative. <https://doi.org/10.6073/pasta/dbddf81ba3156c95b9c20d80b8c90e6e>.                                      |
| Time series of kelp forest community dynamics       | Reed, D, R. Miller. 2023. SBC LTER: Reef: Annual time series of biomass for kelp forest species, ongoing since 2000 ver 13. Environmental Data Initiative. <https://doi.org/10.6073/pasta/f2d0beb83ce7ed6949364ac28df790ea>.                                   |
| Lobster functional responses                        | Santa Barbara Coastal LTER, B. DiFiore, and A. Stier. 2023. SBC LTER: Reef: The size-dependent functional response of lobster foraging on purple urchin ver 1. Environmental Data Initiative. <https://doi.org/10.6073/pasta/f3878aad622dfe9b05a7d0e75d39bddb> |

## Acknowledgements

Many individuals contributed to this manuscript. We thank Drs. Jameal Samhouri, Dan Reed, Holly Moeller, Ana Miller-ter Kuile, and the Ocean Recoveries lab group for providing invaluable guidance on previous drafts of this manuscript. We would also like to thank Drs. Erik Ward, Stephen Proulx, and Dan Ovando for assistance in developing the Bayesian model. Joseph Curtis and many undergraduate researchers were integral to conducting the mesocosm experiment and maintaining the animals in captivity. Finally, the integration of experimental results with long-term data would not have been possible without the efforts of Clint Nelson, Li Kui, and many others involved with the SBC LTER. This work was funded by an NSF Graduate Research Fellowship, a University of California Chancellor's award, the California Sea Grant Prop 84 grant program (R/OPCOAH-2), and the Santa Barbara Coastal Long-Term Ecological Research program (NSF OCE 1831937).
